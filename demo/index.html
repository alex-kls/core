<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <script src="build/fin-hypergrid.js"></script>
    <script>
        'use strict';

        var HTTP_STATE_DONE = 4,
            HTTP_STATUS_OK = 200;

        function get(url, callback) {
            var httpRequest = new XMLHttpRequest();
            httpRequest.open('GET', url, true);
            httpRequest.onreadystatechange = function() {
                if (
                    httpRequest.readyState === HTTP_STATE_DONE &&
                    httpRequest.status === HTTP_STATUS_OK
                ) {
                    callback(JSON.parse(httpRequest.responseText));
                }
            };
            httpRequest.send(null);
        }

        window.onload = function() {
            get('data/datadoc.json', function(result) {
                var loadingSpan = document.querySelector('span#loading');
                loadingSpan.style.visibility = "hidden";
                var div = document.querySelector('div#json-example');
                var inLoad = false;

                var colDef = [{
                    "colId": "$$row_number",
                    "headerName": "",
                    "width": 50,
                    "pinned": "left",
                    "suppressMenu": true,
                    "suppressMovable": true,
                    "suppressResize": true,
                    "suppressSorting": true,
                    "suppressSizeToFit": true,
                    "enableRowResizing": true
                }, {
                    "colId": "c0",
                    "field": "c0",
                    "originalField": "c0",
                    "headerName": "Field 1",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }, {
                    "colId": "c1",
                    "field": "c1",
                    "originalField": "c1",
                    "headerName": "Field 2",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }, {
                    "colId": "c2",
                    "field": "c2",
                    "originalField": "c2",
                    "headerName": "Field 3",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }, {
                    "colId": "c3",
                    "field": "c3",
                    "originalField": "c3",
                    "headerName": "Field 4",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }, {
                    "colId": "c4",
                    "field": "c4",
                    "originalField": "c4",
                    "headerName": "Field 5",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }, {
                    "colId": "c5",
                    "field": "c5",
                    "originalField": "c5",
                    "headerName": "Field 6",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }, {
                    "colId": "c6",
                    "field": "c6",
                    "originalField": "c6",
                    "headerName": "Field 7",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }, {
                    "colId": "c7",
                    "field": "c7",
                    "originalField": "c7",
                    "headerName": "Field 8",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }, {
                    "colId": "c8",
                    "field": "c8",
                    "originalField": "c8",
                    "headerName": "Field 9",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }, {
                    "colId": "c9",
                    "field": "c9",
                    "originalField": "c9",
                    "headerName": "Field 10",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }, {
                    "colId": "c10",
                    "field": "c10",
                    "originalField": "c10",
                    "headerName": "Field 11",
                    "suppressSorting": false,
                    "minWidth": 10,
                    "maxWidth": 2000,
                    "suppressMenu": 0,
                    "suppressMovable": false,
                    "suppressSizeToFit": false,
                    "sort": null,
                    "sortedAt": null,
                    "columnGroupShow": "open"
                }];

                function prepareData(result) {
                    var res = [];
                    result.data.children.forEach(function(c) {
                        res.push(c.data);
                    });
                    return res;
                }

                function prepareSchema(result) {
                    var res = [];
                    result.headers.children.forEach(function(h) {
                        res.push({ header: h.key, name: h.key });
                    });
                    return res;
                }

                function loadData(result) {
                    inLoad = false;
                    window.grid.api.setColumnDefs(colDef);
                    window.grid.api.setRowData(prepareData(result));
                }

                function onScrollEnd() {
                    console.log("SCROLL END");
                    if (!inLoad) {
                        inLoad = true;
                        get('data/datadoc.json', loadData);
                    }
                }

                var options = {
                    schema: prepareSchema(result),
                    data: [],
                    api: {
                        onScrollEndLimitTrigger: 200,
                        onScrollEnd: onScrollEnd
                    }
                };
                window.grid = new fin.Hypergrid(div, options);

                var themeObject = {
                    noDataMessage: 'Zero Rows!',
                    backgroundColor: 'white',
                    foregroundSelectionFont: '12px "Helvetica Neue",Helvetica,Arial,sans-serif',
                    backgroundSelectionColor: 'rgb(236,243,255)',
                    columnHeaderBackgroundColor: 'rgb(243,243,243)',
                    rowHeaderBackgroundColor: 'rgb(243,243,243)',
                    foregroundSelectionColor: '#333',
                    columnClip: false,
                    defaultRowHeight: 21,
                    editor: 'textfield',
                    rowHeaderColor: '#333',
                    lineColor: '#DEDEDE',
                    renderFalsy: true,
                    rowHeaderCheckboxes: false,
                    rowHeaderForegroundSelectionFont: '12px "Helvetica Neue",Helvetica,Arial,sans-serif',
                    font: '12px "Helvetica Neue",Helvetica,Arial,sans-serif',
                    columnHeaderFont: 'bold 13px "Helvetica Neue",Helvetica,Arial,sans-serif',
                    selectionRegionOutlineColor: 'rgb(66,133,244)',
                    gridBorder:true,
                    hoverColumnHighlight: false,
                    hoverRowHighlight: false,
                    halign: 'left',
                    combineColors: false,
                    cellContextMenu: {
                        items:[
                            {
                                title: 'Copy',
                                callbackFn: function (clickEvent, gridEvent) {
                                    console.log('first callback works fine');
                                    console.log('grid event', gridEvent);
                                },
                                children: {
                                    items:[
                                        {
                                            title: 'third',
                                            callbackFn: function (clickEvent, gridEvent) {
                                                console.log('third callback works fine');
                                            },
                                            isShown: function (event) {
                                                return true;
                                            },
                                            children: {
                                                items:[
                                                    {
                                                        title: 'third',
                                                        callbackFn: function (clickEvent, gridEvent) {
                                                            console.log('third callback works fine');
                                                        }
                                                    },
                                                    {
                                                        title: 'fourth',
                                                        callbackFn: function (clickEvent, gridEvent) {
                                                            console.log('fourth callback works fine');
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        {
                                            title: 'fourth',
                                            callbackFn: function (clickEvent, gridEvent) {
                                                console.log('fourth callback works fine');
                                            }
                                        }
                                    ]
                                }
                            },
                            {
                                title: 'Copy With Headers',
                                callbackFn: function (clickEvent, gridEvent) {
                                    console.log('second callback works fine');
                                }
                            }
                        ]
                    }
                };

                grid.applyTheme(themeObject);

                grid.api.setColumnDefs(colDef);


                setTimeout(function() {
                    window.grid.api.setColumnDefs(colDef);
                    window.grid.api.setRowData(prepareData(result));
                },1000);

            });
        };
    </script>
    <style>
        div.finbar-horizontal > .thumb,
        div.finbar-vertical > .thumb {
            background-color: #000 !important;
            opacity: 0.7 !important;
        }
    </style>
</head>
<body>

<p> Fin-HyperGrid example using AJAX. <span id="loading">Loading... </span></p>
<div id="json-example" style="position:relative; width:100%; height: 100%"></div>
</body>
</html>
